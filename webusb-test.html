<html>
    <head>
        <title>WebSerial Prototype</title>
        <style>
            
        </style>
    </head>
    <body>
        <h1>The Hygroscopinator</h1>
        <h2>~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~</h2>
        <div class="sensor" id="humidity">
            <h3>Soil Humidity</h3>
            <div class="log">sybau ðŸ’”</div>
        </div>
        <div class="sensor" id="luminosity">
            <h3>Light</h3>
            <div class="log">sybau ðŸ’”</div>
        </div>
        <div class="sensor" id="protonicity">
            <h3>pH</h3>
            <div class="log">sybau ðŸ’”</div>
        </div>
        <h2>~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~</h2>
        <!-- Step 1: include our secure javascript file -->
        <script src="https://www.desmos.com/api/v1.11/calculator.js?apiKey=70d530c75bc2432bbfc6dce64cf7fb0e"></script>
        
        <!-- Step 2: add an element to the page -->
        <div id="calculator" style="width: 600px; height: 400px;"></div>
        <script type="module">
            if (!("serial" in navigator)) {
                alert("what cooked ahh browser are we on");
                throw "ðŸŸ";
            }

            var elt = document.getElementById('calculator');
            var calculator = Desmos.GraphingCalculator(elt);
            
            let port;
            let w;
            
            try {
                /*navigator.usb.getDevices().then((devices) => {
                devices.forEach((device) => {
                console.log(device.productName); // "Arduino Uno"
                console.log(device.manufacturerName); // "Arduino LLC"
                });
                });*/
                port = await navigator.serial.requestPort();
                
                await port.open({baudRate: 9600});
            }
            catch (ðŸŸ) {
                alert("Connection terminated.", ðŸŸ);
            }

            function onRX(data) {
                const [sensor, value] = data.split(':3');
                sensorChange(sensor, value);
            }
            
            function sensorChange(sensor, data) {
                const div = document.getElementById(sensor);
                const log = div.getElementsByClassName("log")[0];
                log.append(`\n${data}`);
            }
            
            window.exe = e => eval(e);
        </script>
    </body>
</html>
